function btMinimize(){jQuery("#bTranslateContainer").css("display","none")}function btTranslate(e,t,a,n,r,s){if(e||(e=document.activeElement),t||(t=jQuery("#wpadminbar")),a||(a=!0),n||(n="auto"),!r){r=document.documentElement.lang;var i=new URLSearchParams(window.location.search);i.has("new_lang")&&(r=i.get("new_lang"))}"string"==typeof e&&(e=jQuery("#"+e));var l=btGetSelected(e);if("object"==typeof l&&(l=l.toString()),!l){if(s)return"";l="Please select some text and press translate again: the results will appear here."}return btGoogleGet(t,l,n,r,s)}function btnTranslatebbp(e){var t=e.closest("li");if(t){var a=t.find(".bbp-reply-content");e=a&&a.length>0?a[0]:t[0];var n=t.find(".bbp-meta");return n&&(t=n),btTranslate(e,t)}return e=document.activeElement,btTranslate(e)}function btnTranslateMessage(e){return messageParent=e.parents("div.message-box"),messageParent?(messageDetail=messageParent.find("textarea"),messageDetail&&messageDetail.length>0?e=messageDetail[0]:(messageDetail=messageParent.children("div.message-content"),e=messageDetail&&messageDetail.length>0?messageDetail[0]:messageParent[0]),btTranslate(e,messageParent)):(e=document.activeElement,btTranslate(e))}function btnTranslateActivity(e){return activityParent=e.parents("div.activity-content"),activityParent?(activityDetail=activityParent.children("div.activity-inner"),activityDetail&&0!==activityDetail.length||(activityDetail=activityParent.children("div.activity-header")),e=activityDetail?activityDetail[0]:activityParent[0],btTranslate(e,activityParent)):(e=document.activeElement,btTranslate(e))}function btGetSelected(e,t,a,n){e||(e=document.activeElement),t||(t=window),a||(a=document),n||(n=0);var r="";if(t.getSelection?r=t.getSelection():a.getSelection?r=a.getSelection():a.selection&&(r=a.selection.createRange().text),"object"==typeof r&&(r=r.toString()),(!r||""===r)&&e){if(!e.tagName)return"";switch(e.tagName.toUpperCase()){case"":case"HTML":case"BODY":return"";case"INPUT":case"TEXTAREA":return e.value;case"IFRAME":return n<2&&((r=btGetSelected(e,e.contentWindow,e.contentDocument,n+1))&&""!==r||(innerEl=e.contentDocument.activeElement,r=innerEl?innerEl.innerText:e.contentDocument.body.innerText)),r;default:r=e.innerText}}return r}function btUpdateTarget(e,a,n){if(n||(n=0),e)switch(e.tagName.toUpperCase()){case"":case"HTML":case"BODY":return!1;case"INPUT":return e.value=a,!0;case"TEXTAREA":return e.value=a,e.innerHTML=a,!0;case"IFRAME":return n<2&&(t=btUpdateTarget(e,e.contentWindow,e.contentDocument,n+1),t&&""!==t||(e.contentDocument.body.innerText=a),!0);default:return e.innerText=a,!0}}function btExtractText(e){var t="",a=2;if(jQuery.isArray(e)?(matchResult=e,a=1):("string"!=typeof e&&(e=e.toString()),/"/.test(e)?matchResult=e.match(/"(.*?)"/g):(matchResult=e.split(","),a=5)),matchResult.length<3)t+=matchResult[0];else for(i=0;i<matchResult.length-3;i+=a)sResult=matchResult[i].replace(/(^")|("$)/g,"").trim(),"\n"===sResult||"\r"===sResult||(t+=sResult+"<br />");return t}function btGoogleGet(e,t,a,n,r){e||(e=jQuery("#wpadminbar")),t||(t="Please select some text and press translate again: the results will appear here."),a||(a="auto"),n||(n=document.documentElement.lang),startSpinner();var s="//translate.googleapis.com/translate_a/single?client=gtx&sl="+a+"&tl="+n+"&dt=t&q="+encodeURI(t),l="http://translate.google.cn/#"+mapGoogleLanguageCode(a)+"/"+mapGoogleLanguageCode(n)+"/"+encodeURI(t);jQuery("#bTranslateLink").attr("href",l);(new Date).getTime();return jQuery.ajax(s,{type:"GET",timeout:9e3}).done(function(t,a,n){if(translateResult="",jQuery.isArray(t)&&(t=t[0]),jQuery.isArray(t))for(i=0;i<t.length;i+=1)sResult=t[i],jQuery.isArray(sResult)&&(sResult=sResult[0]),sResult.replace(/(^")|("$)/g,"").trim(),"\n"===sResult||"\r"===sResult||(translateResult+=sResult+"<br />");else translateResult=btExtractText(t);var s=jQuery("#bTranslateResult");s.text(translateResult),s.html(s.text().replace(/\\n\\n/g,"<br />").replace(/\\n/g,"<br />")),r?btUpdateTarget(r,s.text()):(s=jQuery("#bTranslateContainer").detach(),e.append(s),s.css("display","block"))}).fail(function(t,a,n){var r="";switch(a){case"parsererror":break;case"timeout":r="Translation timed out.\n";break;default:r=" Failed on: "+a+"\n"}"timeout"!==a&&(r+=btExtractText(t.responseText));var s=jQuery("#bTranslateResult");s.text(r),s.html(s.text().replace(/\\n\\n/g,"<br />").replace(/\\n/g,"<br />")),s=jQuery("#bTranslateContainer").detach(),e.append(s),s.css("display","block")}).always(function(e,t,a){stopSpinner()}),!0}function startSpinner(){jQuery("#translate-icon").addClass("spinner")}function stopSpinner(){jQuery("#translate-icon").removeClass("spinner")}function mapGoogleLanguageCode(e){switch(e||(e="auto"),e){case"auto":case"zh-TW":case"zh-CN":return e;default:return e.length>2?e.substr(0,2):e}}function translateNewProduct(e){for(var t=new Array("title","content","excerpt","name","slug","description"),a=0,n=t.length;a<n;a++){var r=jQuery("#"+t[a]);try{r[0]&&(r=r[0])}catch(e){}r&&btTranslate(r,"",!1,"auto",e,r)}}jQuery(document).ready(function(e){e("#wp-admin-bar-jm-buddy-translate").mousedown(function(){btTranslate()})});